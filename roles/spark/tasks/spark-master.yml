---
- block:
  - name: set up spark history (1/4)
    shell: "{{ hdfs_exe_dir|default('JAVA_HOME=/usr /opt/hadoop/default/bin') }}/hadoop fs -mkdir -p {{ spark_hdfs_dir }}"

  - name: set up spark history (2/4)
    shell: "{{ hdfs_exe_dir|default('JAVA_HOME=/usr /opt/hadoop/default/bin') }}/hadoop fs -mkdir -p {{ spark_hdfs_dir }}/{{ spark_history_dir }}"

  - name: set up spark history (3/4)
    shell: "{{ hdfs_exe_dir|default('JAVA_HOME=/usr /opt/hadoop/default/bin') }}/hadoop fs -chown -R spark:spark {{ spark_hdfs_dir }}"

  - name: set up spark history (4/4)
    shell: "{{ hdfs_exe_dir|default('JAVA_HOME=/usr /opt/hadoop/default/bin') }}/hadoop fs -chmod 1777 {{ spark_hdfs_dir }}/{{ spark_history_dir }}"

  become: yes
  become_user: "{{ hdfs_user|default('hadoop') }}"
  delegate_to: "{{ groups['hadoop-namenode-node'][0] }}"
  run_once: true
  tags: spark

- name: copy supervisord config
  template:
    src=spark-master-supervisord.conf.j2
    dest={{ supervisord_programs_dir }}/spark-master-supervisord.conf
    mode=0644
  notify:
    - reread supervisord
    - restart spark master
  tags: spark
