input {
  file {
    path => ['/var/log/youscrape/*.log']
    codec => json
    tags => ['youscrape']
  }
}

output {
  if 'youscrape' in [tags]{
    elasticsearch {
      hosts => "{{ groups['elasticsearch-nodes'][0] }}:{{ elasticsearch_network_http_port|default(9200) }}"
      template => "/etc/logstash/templates/logs-template.json"
      template_name => "logs-*"
      template_overwrite => true
      index => "logs-{{ deploy_env }}-youscrape-%{+YYYY.MM}"
      document_type => "%{[logger]}"
      {% if logstash_credentials is defined and logstash_credentials == true %}
      user => "ist-es"
      password => "{{ logstash_es_pwd }}"
      {% endif %}
    }
  }
}
