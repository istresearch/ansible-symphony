input {
  file {
    path => ['/var/log/container-logs/*.log']
    codec => json
    tags => ['{{ logstash_tag }}']
  }
}

filter {
    if [level] =~ /^DEBUG/ {
        drop { }
    }
}

output {
    if '{{ logstash_tag }}' in [tags]{
        elasticsearch {
            hosts => "{{ groups['elasticsearch-nodes'][0] }}:{{ elasticsearch_network_http_port|default(9200) }}"
            template => "/etc/logstash/templates/logs-template.json"
            template_name => "logs-*"
            template_overwrite => true
            index => "logs-{{ deploy_env }}-{{ logstash_tag }}-%{+YYYY.MM.dd}"
            document_type => "%{[logger]}"
            {% if logstash_credentials is defined and logstash_credentials == true %}
            user => "ist-es"
            password => "{{ logstash_es_pwd }}"
            {% endif %}
        }
    }
}
