version: '2'

services:
  track_0:
    image: istresearch/traptor:v1.3.0
    volumes:
      - logs:/var/log/traptor
    environment:
      - TRAPTOR_TYPE=track
      - TRAPTOR_ID=0
      - RULE_CHECK_INTERVAL=60
      - USE_SENTRY=true
      - SENTRY_URL=https://{{ sentry_url_un }}:{{ sentry_url_pwd }}@sentry.io/55250
      - LOG_LEVEL=INFO
      - LOG_DIR=/var/log/traptor
      - LOG_FILE_NAME=traptor_track_0.log
      - KAFKA_ENABLED=true
      - KAFKA_HOSTS={{ kafka_hosts }}
      - KAFKA_TOPIC=traptor.cooper_prod
      - REDIS_HOST=memex-services.istresearch.com
      - REDIS_PORT=6379
      - REDIS_DB=1
      - REDIS_PUBSUB_CHANNEL=traptor-notify-prod
      - CONSUMER_KEY={{ track0_consumer_key }}
      - CONSUMER_SECRET={{ track0_consumer_secret }}
      - ACCESS_TOKEN={{ track0_access_token }}
      - ACCESS_TOKEN_SECRET={{ track0_access_token_secret }}
      - STATSD_HOST_IP=172.17.0.1
    restart: "on-failure:3"
    depends_on:
      - logstash

  track_1:
    image: istresearch/traptor:v1.3.0
    volumes:
      - logs:/var/log/traptor
    environment:
      - TRAPTOR_TYPE=track
      - TRAPTOR_ID=1
      - RULE_CHECK_INTERVAL=60
      - USE_SENTRY=true
      - SENTRY_URL=https://{{ sentry_url_un }}:{{ sentry_url_pwd }}@sentry.io/55250
      - LOG_LEVEL=INFO
      - LOG_DIR=/var/log/traptor
      - LOG_FILE_NAME=traptor_track_1.log
      - KAFKA_ENABLED=true
      - KAFKA_HOSTS={{ kafka_hosts }}
      - KAFKA_TOPIC=traptor.cooper_prod
      - REDIS_HOST=memex-services.istresearch.com
      - REDIS_PORT=6379
      - REDIS_DB=1
      - REDIS_PUBSUB_CHANNEL=traptor-notify-prod
      - CONSUMER_KEY={{ track1_consumer_key }}
      - CONSUMER_SECRET={{ track1_consumer_secret }}
      - ACCESS_TOKEN={{ track1_access_token }}
      - ACCESS_TOKEN_SECRET={{ track1_access_token_secret }}
      - STATSD_HOST_IP=172.17.0.1
    restart: "on-failure:3"
    depends_on:
      - logstash

  track_2:
    image: istresearch/traptor:v1.3.0
    volumes:
      - logs:/var/log/traptor
    environment:
      - TRAPTOR_TYPE=track
      - TRAPTOR_ID=2
      - RULE_CHECK_INTERVAL=60
      - USE_SENTRY=true
      - SENTRY_URL=https://{{ sentry_url_un }}:{{ sentry_url_pwd }}@sentry.io/55250
      - LOG_LEVEL=INFO
      - LOG_DIR=/var/log/traptor
      - LOG_FILE_NAME=traptor_track_2.log
      - KAFKA_ENABLED=true
      - KAFKA_HOSTS={{ kafka_hosts }}
      - KAFKA_TOPIC=traptor.cooper_prod
      - REDIS_HOST=memex-services.istresearch.com
      - REDIS_PORT=6379
      - REDIS_DB=1
      - REDIS_PUBSUB_CHANNEL=traptor-notify-prod
      - CONSUMER_KEY={{ track2_consumer_key }}
      - CONSUMER_SECRET={{ track2_consumer_secret }}
      - ACCESS_TOKEN={{ track2_access_token }}
      - ACCESS_TOKEN_SECRET={{ track2_access_token_secret }}
      - STATSD_HOST_IP=172.17.0.1
    restart: "on-failure:3"
    depends_on:
      - logstash

  track_3:
    image: istresearch/traptor:v1.3.0
    volumes:
      - logs:/var/log/traptor
    environment:
      - TRAPTOR_TYPE=track
      - TRAPTOR_ID=3
      - RULE_CHECK_INTERVAL=60
      - USE_SENTRY=true
      - SENTRY_URL=https://{{ sentry_url_un }}:{{ sentry_url_pwd }}@sentry.io/55250
      - LOG_LEVEL=INFO
      - LOG_DIR=/var/log/traptor
      - LOG_FILE_NAME=traptor_track_3.log
      - KAFKA_ENABLED=true
      - KAFKA_HOSTS={{ kafka_hosts }}
      - KAFKA_TOPIC=traptor.cooper_prod
      - REDIS_HOST=memex-services.istresearch.com
      - REDIS_PORT=6379
      - REDIS_DB=1
      - REDIS_PUBSUB_CHANNEL=traptor-notify-prod
      - CONSUMER_KEY={{ track3_consumer_key }}
      - CONSUMER_SECRET={{ track3_consumer_secret }}
      - ACCESS_TOKEN={{ track3_access_token }}
      - ACCESS_TOKEN_SECRET={{ track3_access_token_secret }}
      - STATSD_HOST_IP=172.17.0.1
    restart: "on-failure:3"
    depends_on:
      - logstash

  track_4:
    image: istresearch/traptor:v1.3.0
    volumes:
      - logs:/var/log/traptor
    environment:
      - TRAPTOR_TYPE=track
      - TRAPTOR_ID=4
      - RULE_CHECK_INTERVAL=60
      - USE_SENTRY=true
      - SENTRY_URL=https://{{ sentry_url_un }}:{{ sentry_url_pwd }}@sentry.io/55250
      - LOG_LEVEL=INFO
      - LOG_DIR=/var/log/traptor
      - LOG_FILE_NAME=traptor_track_4.log
      - KAFKA_ENABLED=true
      - KAFKA_HOSTS={{ kafka_hosts }}
      - KAFKA_TOPIC=traptor.cooper_prod
      - REDIS_HOST=memex-services.istresearch.com
      - REDIS_PORT=6379
      - REDIS_DB=1
      - REDIS_PUBSUB_CHANNEL=traptor-notify-prod
      - CONSUMER_KEY={{ track4_consumer_key }}
      - CONSUMER_SECRET={{ track4_consumer_secret }}
      - ACCESS_TOKEN={{ track4_access_token }}
      - ACCESS_TOKEN_SECRET={{ track4_access_token_secret }}
      - STATSD_HOST_IP=172.17.0.1
    restart: "on-failure:3"
    depends_on:
      - logstash

  track_5:
    image: istresearch/traptor:v1.3.0
    volumes:
      - logs:/var/log/traptor
    environment:
      - TRAPTOR_TYPE=track
      - TRAPTOR_ID=5
      - RULE_CHECK_INTERVAL=60
      - USE_SENTRY=true
      - SENTRY_URL=https://{{ sentry_url_un }}:{{ sentry_url_pwd }}@sentry.io/55250
      - LOG_LEVEL=INFO
      - LOG_DIR=/var/log/traptor
      - LOG_FILE_NAME=traptor_track_5.log
      - KAFKA_ENABLED=true
      - KAFKA_HOSTS={{ kafka_hosts }}
      - KAFKA_TOPIC=traptor.cooper_prod
      - REDIS_HOST=memex-services.istresearch.com
      - REDIS_PORT=6379
      - REDIS_DB=1
      - REDIS_PUBSUB_CHANNEL=traptor-notify-prod
      - CONSUMER_KEY={{ track5_consumer_key }}
      - CONSUMER_SECRET={{ track5_consumer_secret }}
      - ACCESS_TOKEN={{ track5_access_token }}
      - ACCESS_TOKEN_SECRET={{ track5_access_token_secret }}
      - STATSD_HOST_IP=172.17.0.1
    restart: "on-failure:3"
    depends_on:
      - logstash

  track_6:
    image: istresearch/traptor:v1.3.0
    volumes:
      - logs:/var/log/traptor
    environment:
      - TRAPTOR_TYPE=track
      - TRAPTOR_ID=6
      - RULE_CHECK_INTERVAL=60
      - USE_SENTRY=true
      - SENTRY_URL=https://{{ sentry_url_un }}:{{ sentry_url_pwd }}@sentry.io/55250
      - LOG_LEVEL=INFO
      - LOG_DIR=/var/log/traptor
      - LOG_FILE_NAME=traptor_track_6.log
      - KAFKA_ENABLED=true
      - KAFKA_HOSTS={{ kafka_hosts }}
      - KAFKA_TOPIC=traptor.cooper_prod
      - REDIS_HOST=memex-services.istresearch.com
      - REDIS_PORT=6379
      - REDIS_DB=1
      - REDIS_PUBSUB_CHANNEL=traptor-notify-prod
      - CONSUMER_KEY={{ track6_consumer_key }}
      - CONSUMER_SECRET={{ track6_consumer_secret }}
      - ACCESS_TOKEN={{ track6_access_token }}
      - ACCESS_TOKEN_SECRET={{ track6_access_token_secret }}
      - STATSD_HOST_IP=172.17.0.1
    restart: "on-failure:3"
    depends_on:
      - logstash

  track_7:
    image: istresearch/traptor:v1.3.0
    volumes:
      - logs:/var/log/traptor
    environment:
      - TRAPTOR_TYPE=track
      - TRAPTOR_ID=7
      - RULE_CHECK_INTERVAL=60
      - USE_SENTRY=true
      - SENTRY_URL=https://{{ sentry_url_un }}:{{ sentry_url_pwd }}@sentry.io/55250
      - LOG_LEVEL=INFO
      - LOG_DIR=/var/log/traptor
      - LOG_FILE_NAME=traptor_track_7.log
      - KAFKA_ENABLED=true
      - KAFKA_HOSTS={{ kafka_hosts }}
      - KAFKA_TOPIC=traptor.cooper_prod
      - REDIS_HOST=memex-services.istresearch.com
      - REDIS_PORT=6379
      - REDIS_DB=1
      - REDIS_PUBSUB_CHANNEL=traptor-notify-prod
      - CONSUMER_KEY={{ track7_consumer_key }}
      - CONSUMER_SECRET={{ track7_consumer_secret }}
      - ACCESS_TOKEN={{ track7_access_token }}
      - ACCESS_TOKEN_SECRET={{ track7_access_token_secret }}
      - STATSD_HOST_IP=172.17.0.1
    restart: "on-failure:3"
    depends_on:
      - logstash

  logstash:
    container_name: traptor_track_logstash
    image: logstash:latest
    command: logstash -f /etc/logstash/conf.d/logstash.conf
    volumes:
      - /opt/docker_configs/logstash-traptor-prod.conf:/etc/logstash/conf.d/logstash.conf
      - /opt/docker_configs/logs-template.json:/etc/logstash/templates/logs-template.json
      - logs:/var/log/traptor

volumes:
  logs:

