input {
  kafka {
    topic_id => "{{ gnip_monitor_dev_name }}"
    consumer_threads => "{{ gnip_monitor_consumer_threads }}"
    zk_connect => "{% for host in groups['zookeeper-nodes'] %}{{ host }}:{{ zookeeper_port|default(2181) }}{% if not loop.last %},{% endif %}{% endfor %}"
    group_id => "{{ gnip_monitor_dev_name}}-logstash"
    tags => ["{{ gnip_monitor_dev_name}}"]
  }
}

output {
  if "{{ gnip_monitor_dev_name}}" in [tags] {
    elasticsearch {
      host => "{{ groups['elasticsearch-nodes'][0] }}"
      port => {{ gnip_monitor_es_port }}
      protocol => http
      ssl => {{ gnip_monitor_ssl }}
      user => "{{ gnip_monitor_es_user }}"
      password => "{{ gnip_monitor_es_password }}"
      template => "{{ logstash_template_dir }}/{{ gnip_monitor_dev_name }}.json"
      template_name => "{{ gnip_monitor_dev_name}}-logstash.conf"
      template_overwrite => true
      index => "{{ gnip_monitor_dev_name }}-%{+YYYY.MM}"
      index_type => "{{ gnip_monitor_doc_type }}"
      document_id => "%{[d_id]}"
    }
  }
}